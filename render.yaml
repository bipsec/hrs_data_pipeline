# Render Blueprint â€“ deploy from GitHub. Set MongoDB credentials in Dashboard (Environment).
services:
  - type: web
    name: hrs-data-pipeline
    runtime: python
    plan: free

    # Install your package + ensure deps are fresh
    buildCommand: pip install --upgrade pip && pip install .

    # IMPORTANT: keep workers=1 on free tier to avoid multiplying memory
    startCommand: uvicorn src.api.app:app --host 0.0.0.0 --port $PORT --workers 1

    healthCheckPath: /years

    envVars:
      # Recommended: full Atlas URI in Render Dashboard as secret
      - key: MONGODB_CONNECTION_STRING
        sync: false

      # Optional: DB name (default hrs_data). If your URI already includes /hrs_data,
      # this can still be set but isn't required.
      - key: MONGODB_DATABASE_NAME
        value: hrs_data

      # Keep these OFF unless you really use Option B
      - key: MONGODB_USER
        sync: false
      - key: MONGODB_PASSWORD
        sync: false
      - key: MONGODB_ATLAS_CLUSTER
        sync: false
      - key: MONGODB_ATLAS_CONNECTION_STRING
        sync: false
